    <!doctype html>
    <html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        

        <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
        <!-- App css-->
        <link rel="stylesheet" type="text/css" href="css/style.css">
        <title>Gird</title>
        <style>
            body{
                width:100%;
                padding:20px;
            }
        /* hide featch grid data table on loading page */
            {% comment %} #ratetable {
                display: none;
            } {% endcomment %}
        </style>
    </head>
    <body>
        <div class="container-fluid general-widget">
            <div class="card">
                <div class="card-header" style="background: #0c7097; color:white;" >
    View Rate</div>

        <div class="card">
            <div class="card-header pb-0">

    
    
        <form class="form theme-form >" method="POST" action="" enctype="multipart/form-data">
            {% csrf_token %}
            <a href="#" value="{{request.user.username}}">{{request.user.username}}</a>
            <a href="{% url 'accounts:logout' %}">logout</a>

            <div class="form-row">
                <div class="col-md-4 col-sm-12 form-group">
                    <label for="companyoptions">Provider</label>
                    <select id="companyoptions" class="form-control" name="company" multiple>
                        <option value="" selected>Select Company</option>
                        {% for company in companys %}
                            <option value="{{ company.company }}">{{ company.company }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 col-sm-12 form-group">
                    <label for="productoptions">Product</label>
                    <select id="productoptions" class="form-control" name="product">
                        <option value="" selected>Select Product</option>
                    </select>
                    <div id="productError" class="text-danger"></div>
                </div>

                <div class="col-md-4 col-sm-12 form-group">
                    <label for="productnameoptions">Product Name</label>
                    <select id="productnameoptions" class="form-control" name="product_name">
                        <option value="" selected>Select Product Name</option>
                    </select>
                </div>
                <div class="col-md-4 col-sm-12 form-group">
                    <label for="monthoptions">Month</label>
                    <select id="monthoptions" class="form-control" name="month">
                        <option value="" selected>Select Month</option>
                    </select>
                </div>
                <div class="col-md-4 col-sm-12 form-group">
                    <label for="stateoptions">State</label>
                    <select id="stateoptions" class="form-control" name="state">
                        <option value="" selected>Select State</option>
                    </select>
                </div>
                <div class="col-md-3 col-sm-12 form-group">
                    <label for="rtooptions">RTO</label>
                    <select id="rtooptions" class="form-control" name="rto">
                        <option value="" selected>Select RTO</option>
                    </select>
                </div>

                {% comment %} <div class="col-md-4 col-sm-12 form-group">
                    <label for="vehicaltypeoptions">Vehicle Type</label>
                    <select id="vehicaltypeoptions" class="form-control" name="vehical_type">
                        <option value="" selected>Select Vehicle Type</option>
                    </select>
                </div>
                <div class="col-md-4 col-sm-12 form-group">
                    <label for="vehicalsubtypeoptions">Vehicle Sub Type</label>
                    <select id="vehicalsubtypeoptions" class="form-control" name="vehical_subtype">
                        <option value="" selected>Select Vehicle Sub Type</option>
                    </select>
                </div> {% endcomment %}
               
                
                
            
            </div>
        </form>


<!-- Add the following HTML to your template -->
<div class="card">
    <!-- Additional form elements and buttons go here -->
    <div class="card-body">
        <div class="dt-ext table-responsive">
            <table id="ratetable" class="table table-hover mb-2">
                <thead class="table-active">
                    <tr>
                        <th style="background: #0c7097; color:white;">Company</th>
                        <th style="background: #0c7097; color:white;">vehical_type</th>
                       <th style="background: #0c7097; color:white;">Vehicle Subtype</th>
                        <th style="background: #0c7097; color:white;">Remarks</th>
                        {% comment %} <th>Rate</th> {% endcomment %}
                        <th style="background: #0c7097; color:white;">Point</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows will be dynamically added here -->
                </tbody>
            </table>
        </div>
    </div>
</div>
</div>
  </div>
     <!-- Add the following JavaScript to your template -->
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
     <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
     <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
     
<!-- Add the following script to initialize Select2 on the companyoptions select element -->
{% comment %} <script>
    $(document).ready(function() {
        $('#companyoptions').select2();
    });
</script> {% endcomment %}

<!-- Modify your existing AJAX function for loading products -->
<script>
    $("#companyoptions").change(function () {
        var company_ids = $(this).val();  // Use val() to get selected values as an array

        $.ajax({
            url: "{% url 'grid:ajax_load_product' %}",
            data: {
                'companies': company_ids.join(),  // Convert array to comma-separated string
            },
            success: function (data) {
                var productSelect = $("#productoptions");
                productSelect.empty();  // Clear existing options

                var products = data.products;
                productSelect.append(
                    $("<option>").attr('value', "").text("Select product")
                );

                for (var i = 0; i < products.length; i++) {
                    productSelect.append(
                        $("<option>").attr('value', products[i].product).text(products[i].product)
                    );
                }
            }
        });
    });

</script>

<!-- Modify your existing AJAX function for loading product names -->
<script>
    $("#companyoptions, #productoptions").change(function () {
        var company_ids = $("#companyoptions").val();  // Use val() to get selected values as an array
        var product_id = $("#productoptions").val();

        $.ajax({
            url: "{% url 'grid:ajax_load_product_name' %}",
            data: {
                'companies': company_ids.join(),  // Convert array to comma-separated string
                'product': product_id
            },
            success: function (data) {
                var productnameSelect = $("#productnameoptions");
                productnameSelect.empty();  // Clear existing options

                var productnames = data.product_names;
                productnameSelect.append(
                    $("<option>").attr('value', "").text("Select Product Name")
                );

                for (var i = 0; i < productnames.length; i++) {
                    productnameSelect.append(
                        $("<option>").attr('value', productnames[i].product_name).text(productnames[i].product_name)
                    );
                }
            }
        });
    });
</script>
<!-- Modify your existing AJAX function for loading product names -->
<script>
    $("#companyoptions, #productoptions").change(function () {
        var company_ids = $("#companyoptions").val();  // Use val() to get selected values as an array
        var product_id = $("#productoptions").val();

        $.ajax({
            url: "{% url 'grid:ajax_load_product_name' %}",
            data: {
                'companies': company_ids.join(),  // Convert array to comma-separated string
                'product': product_id
            },
            success: function (data) {
                var productnameSelect = $("#productnameoptions");
                productnameSelect.empty();  // Clear existing options

                var productnames = data.product_names;
                productnameSelect.append(
                    $("<option>").attr('value', "").text("Select Product Name")
                );

                for (var i = 0; i < productnames.length; i++) {
                    productnameSelect.append(
                        $("<option>").attr('value', productnames[i].product_name).text(productnames[i].product_name)
                    );
                }
            }
        });
    });
</script>
<!-- Modify your existing AJAX function for loading months -->
<script>
    $("#companyoptions, #productoptions, #productnameoptions").change(function () {
        var company_ids = $("#companyoptions").val();  // Use val() to get selected values as an array
        var product_id = $("#productoptions").val();
        var product_name_id = $("#productnameoptions").val();

        $.ajax({
            url: "{% url 'grid:ajax_load_month' %}",
            data: {
                'companies': company_ids.join(),  // Convert array to comma-separated string
                'product': product_id,
                'product_name': product_name_id
            },
            success: function (data) {
                var monthSelect = $("#monthoptions");
                monthSelect.empty();  // Clear existing options

                var months = data.months;
                monthSelect.append(
                    $("<option>").attr('value', "").text("Select Month")
                );

                for (var i = 0; i < months.length; i++) {
                    monthSelect.append(
                        $("<option>").attr('value', months[i].month).text(months[i].month)
                    );
                }
            }
        });
    });
</script>
<!-- Modify your existing AJAX function for loading states -->
<script>
    $("#companyoptions, #productoptions, #productnameoptions, #monthoptions").change(function () {
        var company_ids = $("#companyoptions").val();  // Use val() to get selected values as an array
        var product_id = $("#productoptions").val();
        var product_name_id = $("#productnameoptions").val();
        var month_id = $("#monthoptions").val();

        $.ajax({
            url: "{% url 'grid:ajax_load_state' %}",
            data: {
                'companies': company_ids.join(),  // Convert array to comma-separated string
                'product': product_id,
                'product_name': product_name_id,
                'month': month_id
            },
            success: function (data) {
                var stateSelect = $("#stateoptions");
                stateSelect.empty();  // Clear existing options

                var states = data.states;
                stateSelect.append(
                    $("<option>").attr('value', "").text("Select State")
                );

                for (var i = 0; i < states.length; i++) {
                    stateSelect.append(
                        $("<option>").attr('value', states[i].state).text(states[i].state)
                    );
                }
            }
        });
    });
</script>
<!-- Modify your existing AJAX function for loading RTOs -->
<script>
    $("#companyoptions, #productoptions, #productnameoptions, #monthoptions, #stateoptions").change(function () {
        var company_ids = $("#companyoptions").val();  // Use val() to get selected values as an array
        var product_id = $("#productoptions").val();
        var product_name_id = $("#productnameoptions").val();
        var month_id = $("#monthoptions").val();
        var state_id = $("#stateoptions").val();

        $.ajax({
            url: "{% url 'grid:ajax_load_rto' %}",
            data: {
                'companies': company_ids.join(),  // Convert array to comma-separated string
                'product': product_id,
                'product_name': product_name_id,
                'month': month_id,
                'state': state_id
            },
            success: function (data) {
                var rtoSelect = $("#rtooptions");
                rtoSelect.empty();  // Clear existing options

                var rtos = data.rtos;
                rtoSelect.append(
                    $("<option>").attr('value', "").text("Select RTO")
                );

                for (var i = 0; i < rtos.length; i++) {
                    rtoSelect.append(
                        $("<option>").attr('value', rtos[i].rto).text(rtos[i].rto)
                    );
                }
            }
        });
    });
</script>
<!-- Modify your existing AJAX function for loading data -->
<!-- Add the following JavaScript to your template -->
<script>
    $(document).ready(function () {
        $("#companyoptions, #productoptions, #productnameoptions, #monthoptions, #stateoptions, #rtooptions").change(function () {
            var company_ids = $("#companyoptions").val();
            var product_id = $("#productoptions").val();
            var product_name_id = $("#productnameoptions").val();
            var month_id = $("#monthoptions").val();
            var state_id = $("#stateoptions").val();
            var rto_id = $("#rtooptions").val();

            $.ajax({
                url: "{% url 'grid:ajax_load_rate_remarks_agent_payout' %}",
                data: {
                    'company': company_ids.join(),
                    'product': product_id,
                    'product_name': product_name_id,
                    'month': month_id,
                    'state': state_id,
                    'rto': rto_id
                },
                success: function (data) {
                    var tableBody = $("#ratetable tbody");
                    tableBody.empty();

                    for (var i = 0; i < data.results.length; i++) {
                        var result = data.results[i];

                        
                        var newRow = $("<tr>");
                            newRow.append("<td><textarea rows='2' cols='10' class='form-control' readonly>" + result.company + "</textarea></td>");
                            newRow.append("<td><textarea rows='2' cols='20' class='form-control' readonly>" + result.vehical_type + "</textarea></td>");
                            newRow.append("<td><textarea rows='2' cols='30' class='form-control' readonly>" + result.vehical_subtype + "</textarea></td>");
                            newRow.append("<td><textarea rows='2' cols='50' class='form-control' readonly>" + result.remarks + "</textarea></td>");
        
                            if ('{{request.user.username}}' === 'user1') {
                                newRow.append("<td><input type='text' class='form-control' value='" + result.rateuser1 + "' readonly></td>");
                            } else if ('{{request.user.username}}' === 'user2') {
                                newRow.append("<td><input type='text' class='form-control' value='" + result.rateuser2 + "' readonly></td>");
                            } else if ('{{request.user.username}}' === 'user3') {
                                newRow.append("<td><input type='text' class='form-control' value='" + result.rateuser3 + "' readonly></td>");
                            } else {
                                // Handle other user types or default behavior
                                
                            }
        
                            tableBody.append(newRow);
                    }
                }
            });
        });
    });
</script>


</div>
</div>

    </body>
    </html>